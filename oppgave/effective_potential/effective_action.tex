\subsection{The 1PI effective action and the effective potential}
\label{section: effective action}
The generating functional for connected diagrams, $W[J]$, is dependent on the external source current $J$.
Analogously to what is done in thermodynamics and in Lagrangian and Hamiltonian mechanics, we can define a new quantity, with a different independent variable, using the Legendre transformation.
The new independent variable is 
\begin{equation}
    \varphi_J(x) := \frac{\delta W[J]}{\delta J(x)} = \ex{\varphi(x)}_J.
\end{equation}
The subscript $J$ on the expectation value indicate that it is evaluated in the presence of a source.
The Legendre transformation of $W$ is then
\begin{equation}
    \label{1PI effective action}
    \Gamma[\varphi_J]
    = W[J] - \int \dd^4 x \, J(x) \varphi_J(x).
\end{equation}
Using the definition of $\varphi_J$, we have that
\begin{equation}
    \label{effective equation of motion}
    \fdv{\varphi_J(x)} \Gamma[\varphi_J]
    = \int \dd^4 y \, \fdv{J(y)}{\varphi_J(x)} \fdv{J(y)} W[J]
    - \int \dd^4 y \, \fdv{J(y)}{\varphi_J(x)} \varphi_J(y)
    - J(x)
    = - J(x).
\end{equation}
If we compare this to the classical equations of motion of a field $\varphi$ with the action $S$,
\begin{equation}
    \frac{\delta S[\varphi]}{\delta \varphi(x)} = -J(x),
\end{equation}
we see that $\Gamma$ is an action that gives the equation of motion for the expectation value of the field, given a source current $J(x)$.

To interpret $\Gamma$ further we observe what happens if we treat $\Gamma[\varphi]$ as a classical action with a coupling $g$.
The generating functional in this new theory is
\begin{equation}
    \label{partition function with g}
    Z[J, g] = \int \D \varphi 
    \exp{ i g^{-1} \left( \Gamma[\varphi] + \int \dd^4x \varphi(x) J(x) \right) }
\end{equation}
The free propagator in this theory will be proportional to $g$, as it is given by the inverse of the equation of motion for the free theory.
All vertices in this theory, on the other hand, will be proportional to $g^{-1}$, as they are given by the higher order terms in the action $g^{-1}\Gamma$.
This means that a diagram with $V$ vertices and $I$ internal lines is proportional to $g^{I-V}$.
Regardless of what the Feynman-diagrams in this theory are, the number of loops of a connected diagram is $L = I - V + 1$.
\footnote{This is a consequence of the Euler characteristic $\chi = V - E + F$.}
To see this, we first observe that one single loop must have equally many internal lines as vertices, so the formula holds for $L = 1$.
If we add a new loop to a diagram with $n$ loops by joining two vertices, the formula still holds.
If we attach a new vertex with one line, the formula still holds, and as the diagram is connected, any more lines connecting the new vertex to the diagram will create additional loops.
This ensures that the formula holds, by induction.
As a consequence of this, any diagram is proportional to $g^{L-1}$.
This means that in the limit $g \rightarrow 0$, the theory is fully described at the tree-level, i.e. by only considering diagrams without loops.
In this limit, we may use the stationary phase approximation, as described in \autoref{section:gaussian integrals}, which gives
\begin{equation}
    Z[J, g\rightarrow 0] \approx 
    C \det(- \frac{\delta^2 \Gamma[\varphi_J]}{\delta \varphi^2})
    \exp{i g^{-1} \left(\Gamma[\varphi_J] + \int \dd^4x J \varphi_J \right)  }.
\end{equation}
This means that
\begin{equation}
    -i g \ln(Z[J, g]) 
    = g W[J, g] 
    = \Gamma[\varphi_J] + \int \dd^4x\,  J(x) \varphi_J(x) + \mathcal{O}(g),
\end{equation}
which is exactly the Legendre transformation we started out with, modulo the factor $g$.
$\Gamma$ is therefore the action which describes the full theory at the tree level.
For a free theory, the classical action $S$ equals the effective action, as there are no loop diagrams.

The propagator $D(x, y)$, which is the connected 2 point function $\ex{\varphi(x)\varphi(y)}_J$, is given by the second functional derivative of $W[J]$, times $-i$.
Using the chain rule, together with \autoref{effective equation of motion}, we get
\begin{align}
    (-i)\int \dd^4 z \frac{\delta^2 W[J]}{\delta J(x) \delta J(z)} 
    \frac{\delta^2 \Gamma[\varphi_J]}{\delta \varphi_J(z) \varphi_J(y)}
    =
    (-i)\int \dd^4 z \frac{\delta \varphi_J[z]}{\delta J(x)}
    \frac{\delta^2 \Gamma[\varphi_J]}{\delta \varphi_J(z) \varphi_J(y)}
    =
    \fdiff{}{J(x)}  \fdiff{\Gamma[\varphi_J]}{\varphi_J(y)}
    = \delta(x - y).
\end{align}
This shows that the second functional derivative of the effective action is $iD^{-1}$, where $D^{-1}$ is the inverse propagator.
The inverse propagator is the sum of all one-particle-irreducible (1PI) diagrams, with two external vertices.
More generally, $\Gamma$ is the generating functional for 1PI diagrams, which is why it is called the 1PI effective action.

% The expectation value of the ground state field configuration, that is at $J=0$, $\ex{\varphi(x)}_{J=0} = \varphi_0(x)$ obeys the equation of motion
% \begin{equation}
%     \frac{\delta \Gamma[\varphi_0]}{\delta \varphi(x)} = 0.
% \end{equation}
For a constant field configuration $\varphi(x) = \varphi_0$, the effective action, which is a functional, becomes a regular function.
We define the effective action $\Veff$ by
\begin{equation}
    \label{definition effective potential}
    \Gamma[\varphi_0] = - V T \, \Ve_{\mathrm{eff}}(\varphi_0),
\end{equation}
$VT$ is the volume of space-time.
For a constant ground state, the effective potential will equal the energy of this state.
To calculate the effective potential, we can expand the action around this state to calculate the effective action,
by changing variables to $\varphi(x) = \varphi_0 + \eta(x)$.
$\eta(x)$ now parametrizes fluctuations around the ground state, and has by assumption a vanishing expectation value.
The generating functional becomes
\begin{align}
    Z[J] 
    = \int \D (\varphi_0 + \eta) \, 
    \exp{i S[\varphi_0 + \eta] + i \int \dd^4 x J (\varphi_0 + \eta) }
\end{align}
The notation 
\begin{equation}
    \fdiff{S[\varphi_0]}{\varphi(x)}
\end{equation}
indicates that the functional $S[\varphi]$ is differentiated with respect to $\varphi(x)$, then evaluated at $\varphi(x) = \varphi_0$.
The functional version of a Taylor expansion is
\begin{equation}
    S[\varphi_0 + \eta] = 
    S[\varphi_0]
    + \int \dd x \fdv{S[\varphi_0]}{\varphi(x)} \eta(x)
    + \frac{1}{2} \int \dd x \dd y\,  \frac{\delta^2 S[\varphi_0]}{\delta\varphi(x)\delta\varphi(y)} \eta(x) \eta(y)
    + \dots
\end{equation}
We will only consider this expansion up to second order in derivatives for now.
Inserting this into $Z[J]$ we get
\begin{align*}
    &Z[J] = \\ 
    &\int \D \eta  
    \exp{
        i \int \dd^4 x \left(  \Ell[\varphi_0] + J \varphi_0  \right)
        + i \int \dd^4x \left(  \fdv{S[\varphi_0]}{\varphi(x)} + J(x) \right) \eta(x)
        + i \frac{1}{2} \int \dd^4 x \dd^4 y \,  
        \frac{\delta^2 S[\varphi_0]}{\delta\varphi(x)\delta\varphi(y)} \eta(x) \eta(y)
        }
\end{align*}
The first term is constant with respect to $\eta$, and may therefore be taken outside the path integral.
The second term gives rise to tadpole diagrams, which alter the expectation value of $\eta(x)$.
For $J=0$, this expectation value should vanish, so this term can be ignored.
Furthermore, this means that the ground state must minimize the classical potential,
\begin{equation}
    \label{minimize classical potential}
    \diffp{\Ve(\varphi_0)}{\varphi} = 0.
\end{equation}

The one loop approximation to the effective potential is given by the Taylor-expansion up to second order.
This term is a Gaussian integral, and may be evaluated as described in \autoref{section:gaussian integrals},
\begin{equation}
    \int \D \eta \, 
    \exp(
        i \frac{1}{2} \int \dd^4x \dd^4y\,  
        \frac{\delta^2 S[\varphi_0]}{\varphi(x)\varphi(y)} \eta(x) \eta(y)
        )
        = C \det\left( - \fdiff{S[\varphi_0]}{\varphi(x), \varphi(y)} \right)^{-1/2}
\end{equation}
The generating functional for connected diagrams, as defined in \cref{generating functional of connected diagrams}, is therefore
\begin{align}
    \label{generating functional}
    W[J] 
    & = 
    \int\dd^4 x \, \left(\Ell[\varphi_0] + J \varphi_0\right)
    +i \frac{1}{2} \Tr{\ln\left( - \fdiff{S[\varphi_0]}{\varphi(x), \varphi(y)}  \right)}
    + \dots,
\end{align}
where we have used the identity $\ln \det M = \Tr \ln M$.
Using the definition of the effective action, \cref{1PI effective action}, and \cref{definition effective potential} we get an explicit formula for the effective potential to 1 loop order,
\begin{equation}
    \label{effective potential}
    \Veff(\varphi_0) = \Ve(\varphi_0) - \frac{i}{VT}  \frac{1}{2} \Tr{\ln\left( - \fdiff{S[\varphi_0]}{\varphi(x), \varphi(y)}  \right)}.
\end{equation}
